<div class="container">
  <% @conversations.each do |conversation| %>
    <% if conversation.starter_id == current_user.id %>
      <% user = User.find(conversation.recipient_id) %>
    <% else %>
      <% user = User.find(conversation.starter_id)  %>
    <% end %>
    <%= link_to conversation_path(conversation) do %>
      <div class="card col-12 user-name">
        <%= user.first_name %> <%= user.last_name %>
        <%= conversation.messages.last.created_at.in_time_zone("Asia/Tokyo").strftime('%m/%d %H:%M') %>
        <%= conversation.messages.count %>
      </div>
    <% end %>
  <% end %>
  <% @users.each do |user| %>
    <% if user.conversations.present? %>
      <% user.conversations.each do |c| %>
        <%= link_to conversation_path(c) do %>
          <div class="card col-12 user-name">
            <%= user.first_name %> <%= user.last_name %>
          </div>
        <% end %>
      <% end %>
    <% else %>
      <%= simple_form_for(@new_conversation) do |f| %>
        <%= f.input :starter_id, as: :hidden, input_html: { value: current_user.id } %>
        <%= f.input :recipient_id, as: :hidden, input_html: { value: user.id } %>
        <div class="card col-12 user-name">
          <%= user.first_name %> <%= user.last_name %>
          <%= button_tag type: "submit", class: "card-conversation-path"%>
        </div>
        <% end %>
      <% end %>
    <% end %>
  <%= paginate @list %>
</div>
